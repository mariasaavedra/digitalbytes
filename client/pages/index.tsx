import type { NextPage } from "next";
import Head from "next/head";
import styles from "../styles/Home.module.scss";
import axios from "axios";
import { useState, useEffect } from "react";
import Bookmark from "../components/Bookmark.component";
import Article from "../components/Article.component";
import Header from "../components/Header.component";
import ArticleList from "../components/ArticleList.component";
import BookmarkList from "../components/BookmarkList.component";
import { ToastContainer } from "react-toastify";
import Button from "../components/Button.component";
import Modal from "../components/Modal.component";
import BookmarkForm from "../components/BookmarkForm";

interface Attributes {
  url: string;
  content?: string;
  description?: string;
  title?: string;
  cover_url?: string;
}
interface BookmarksResponse {
  attributes: Attributes;
}
interface ArticlesResponse {
  id: number;
  attributes: Attributes;
}

const Home: NextPage = () => {
  const url = "http://api.digitalbytes.com:1337/api";
  const [bookmarks, setBookmarks] = useState<Array<BookmarksResponse>>();
  const [articles, setArticles] = useState<Array<ArticlesResponse>>();
  const [showModal, setShowModal] = useState(false);
  const toggleModal = () => {
    setShowModal(!showModal);
  };

  useEffect(() => {
    axios.get(`${url}/bookmarks/?populate=*`).then((response) => {
      setBookmarks(response.data.data);
    });
    axios.get(`${url}/articles/?populate=*`).then((response) => {
      setArticles(response.data.data);
    });
  }, []);

  if (!bookmarks || !articles) return null;

  return (
    <div className={styles.container}>
      <Head>
        <title>Create Next App</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main className="container mx-auto">
        <div className="flex justify-between">
          <Header />
          <div
            className={
              styles.actions +
              " mt-12 invisible md:visible lg:visible xl:visible sm:visible"
            }
          >
            <Button onClick={toggleModal} priority="outline">
              Submit Content
            </Button>
          </div>
        </div>
        {showModal && (
          <Modal confirmLabel="Submit" handleClose={toggleModal}>
            <>
              <p>Submit an entry below.</p>
              <BookmarkForm></BookmarkForm>
            </>
          </Modal>
        )}
        <div className="mt-4 grid lg:grid-cols-3 sm:grid-cols-1 sm:gap-1 gap-4">
          <BookmarkList></BookmarkList>
          <ArticleList></ArticleList>
        </div>
      </main>
    </div>
  );
};

export default Home;
